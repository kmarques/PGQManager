{% extends "base.html.twig" %}

{% block title %}
    PGQManager - {% block subTitle %}{% endblock %}
    {% if app.request.get('id') %}
        : {{ app.request.get('id')|databaseInfos.displayName }}
    {% endif %}
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('bundles/main/css/main.css') }}"/>
    <link rel="stylesheet" href="{{ asset('bundles/main/css/jquery.dataTables.css') }}"/>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/main/js/jquery.datatables.js') }}"></script>
    <script src="{{ asset('bundles/main/js/main.js') }}"></script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
{% endblock %}

{% block body %}

    <div class="header">
        <nav class="top-menu">
            {% if app.user %}
                <div class="clearfix">
                    <div class="top-right pull-right">
                        <span>{% trans %}Connected as{% endtrans %} {{ app.user.username }}</span>
                        <a href="{{ path('_logout') }}" class="btn btn-success">{% trans %}Disconnect{% endtrans %}</a>
                    </div>
                </div>
            {% endif %}
        </nav>
    </div>

    {% for flashMessage in app.session.flashbag.get('notice') %}
        <div class="flash-message">
            <em>Notice</em>: {{ flashMessage }}
        </div>
    {% endfor %}

    <div class="container-fluid page">
        {% if app.user %}
            <div class="sidebar-left col-md-2">
                <form class="navbar-form" role="search" >
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="{% trans %}Coming soon...{% endtrans %}"
                               name="navsearch" id="navsearch" disabled="disabled">

                        <div class="input-group-btn">
                            <button disabled="disabled" class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i>
                            </button>
                        </div>
                    </div>
                </form>
                {% block sidebar_nav %}
                    <ul id="menu" class="menu">
                        <li>
                            <a href="{{ path('_main_dashboard') }}">{% trans %}Dashboard{% endtrans %}</a>
                            <a class="pull-right" data-toggle="collapse" href="#dashboard-nav"><i
                                        class="glyphicon glyphicon-chevron-down"></i></a>
                        </li>
                        <ul id="dashboard-nav"
                            class="collapse sub-menu{% if app.request.attributes.get('_route') in ['_main_dashboard', '_main_dashboard_filtered'] %} in{% endif %}">
                            {% if ConfigDatabases is defined and ConfigDatabases|length > 0 %}
                                {% for database in ConfigDatabases %}
                                    <li>
                                        <a href="{{ path('_main_dashboard_filtered', {'id': database.id}) }}">{{ database.displayName }}</a>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <li>{% trans %}No database configured{% endtrans %}</li>
                            {% endif %}
                        </ul>
                        <li>
                            <a href="{{ path('_main_failedevent_list') }}">{% trans %}Failed events{% endtrans %}</a>
                            <a class="pull-right" data-toggle="collapse" href="#failedevents-nav">
                                <i class="glyphicon glyphicon-chevron-down"></i>
                            </a>
                        </li>
                        <ul id="failedevents-nav" class="collapse sub-menu{% if app.request.attributes.get('_route') in ['_main_failedevent_list', '_main_failedevent_list_filtered'] %} in{% endif %}">
                            {% if ConfigDatabases is defined and ConfigDatabases|length > 0 %}
                                {% for database in ConfigDatabases %}
                                    <li>
                                        <a href="{{ path('_main_failedevent_list', {'id': database.id}) }}">{{ database.displayName }}</a>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <li>{% trans %}No database configured{% endtrans %}</li>
                            {% endif %}
                        </ul>
                        <li>
                            <a href="{{ path('_config_home') }}">{% trans %}Config{% endtrans %}</a>
                        </li>
                        {% block content_header_more %}
                        {% endblock %}
                    </ul>
                {% endblock %}
            </div>
        {% endif %}

        <div class="{{ app.user ? 'main-content col-md-12' : 'col-md-12' }}" style>
            <div name="flashmessage" class="" style="display:none;">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
            {% block content %}{% endblock %}
        </div>

        {% if app.user %}
            <div class="sidebar-right">
                <span name="close" class="glyphicon glyphicon-remove close"></span>
                <fieldset id="queueInfo">
                    <legend>{% trans %}Queue Infos{% endtrans %}</legend>
                    <div class="content"></div>
                </fieldset>
                <fieldset id="consumerInfo">
                    <legend>{% trans %}Consumer Infos{% endtrans %}</legend>
                    <div class="body"></div>
                </fieldset>
            </div>
        {% endif %}

    </div>

{% endblock %}
